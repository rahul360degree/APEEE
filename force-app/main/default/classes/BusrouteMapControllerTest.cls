@IsTest
public class BusrouteMapControllerTest 
{

    @IsTest
    static void methodName(){

        fflib_ApexMocks mocks = new fflib_ApexMocks();
        BusstopsSelector busstopSelectorMock = (BusstopsSelector)mocks.mock(BusstopsSelector.class);
        RouteplansSelector plansSelectorMock = (RouteplansSelector)mocks.mock(RouteplansSelector.class);

        Id routeId = fflib_IDGenerator.generate(Route__c.SObjectType);
        Set<Id> planIds = new Set<Id> {fflib_IDGenerator.generate(RoutePlan__c.SObjectType)};
        Set<Id> busStopId = new Set<Id> {fflib_IDGenerator.generate(Busstop__c.SObjectType)};

        mocks.startStubbing();
            mocks.when(busstopSelectorMock.sObjectType()).thenReturn(Busstop__c.SObjectType);
            mocks.when(busstopSelectorMock.selectByIdWithRides((Set<Id>)fflib_Match.anyObject())).thenReturn(getStops());

            mocks.when(plansSelectorMock.sObjectType()).thenReturn(RoutePlan__c.SObjectType);
            mocks.when(plansSelectorMock.selectByRouteId((Set<Id>)fflib_Match.anyObject())).thenReturn(getPlans());
        mocks.stopStubbing();

        Application.Selector.setMock(busstopSelectorMock);
        Application.Selector.setMock(plansSelectorMock);


        Test.startTest();
            List<BusrouteMapController.Marker> markers = BusrouteMapController.getMarkersForRoute(routeId);
        Test.stopTest();

        System.assertEquals(8, markers?.size());
        
    }

    private static List<RoutePlan__c> getPlans()
    {
        String jsonString = '[{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yKJUAZ"},"Bus_Stop_Name__c":"Woluwe school","Busstop__c":"a0M7Z00000EZsxBUAT","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yKJUAZ","Is_Active__c":true,"Latitude__c":50.857281909330716,"Longitude__c":4.444917404272483,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:00","Time__c":"13:00:00.000Z","Time_and_Busstopp_Name__c":"13:0 - Woluwe school"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yNlUAJ"},"Bus_Stop_Name__c":"DE LIJN 315 PRINSENDAL / AV REINE ASTRID / vers Tervuren","Busstop_Code__c":"24010","Busstop__c":"a0M7Z00000EZszYUAT","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yNlUAJ","Is_Active__c":true,"Latitude__c":50.836900000000000,"Longitude__c":4.469550000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:18","Time__c":"13:18:00.000Z","Time_and_Busstopp_Name__c":"13:18 - DE LIJN 315 PRINSENDAL / AV REINE ASTRID / vers Tervuren"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yNvUAJ"},"Bus_Stop_Name__c":"DE LIJN 315 POTAARDE / AV REINE ASTRID / vers Tervuren","Busstop_Code__c":"24014","Busstop__c":"a0M7Z00000EZt0NUAT","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yNvUAJ","Is_Active__c":true,"Latitude__c":50.841100000000000,"Longitude__c":4.468680000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:16","Time__c":"13:16:00.000Z","Time_and_Busstopp_Name__c":"13:16 - DE LIJN 315 POTAARDE / AV REINE ASTRID / vers Tervuren"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yOXUAZ"},"Bus_Stop_Name__c":"AV BARON D\'HUART / AV DES FRENES","Busstop_Code__c":"24028","Busstop__c":"a0M7Z00000EZt0bUAD","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yOXUAZ","Is_Active__c":true,"Latitude__c":50.833700000000000,"Longitude__c":4.468940000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:22","Time__c":"13:22:00.000Z","Time_and_Busstopp_Name__c":"13:22 - AV BARON D\'HUART / AV DES FRENES"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yObUAJ"},"Bus_Stop_Name__c":"AV BARON D\'HUART / AV DES FAISANS","Busstop_Code__c":"24029","Busstop__c":"a0M7Z00000EZt0cUAD","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yObUAJ","Is_Active__c":true,"Latitude__c":50.828600000000000,"Longitude__c":4.473280000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:26","Time__c":"13:26:00.000Z","Time_and_Busstopp_Name__c":"13:26 - AV BARON D\'HUART / AV DES FAISANS"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yOkUAJ"},"Bus_Stop_Name__c":"AV BARON D\'HUART / HEIDEKRUIDLAAN","Busstop_Code__c":"24036","Busstop__c":"a0M7Z00000EZt0jUAD","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yOkUAJ","Is_Active__c":true,"Latitude__c":50.831200000000000,"Longitude__c":4.472550000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:24","Time__c":"13:24:00.000Z","Time_and_Busstopp_Name__c":"13:24 - AV BARON D\'HUART / HEIDEKRUIDLAAN"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yP3UAJ"},"Bus_Stop_Name__c":"AV DES TOURTERELLES / AV DES BICHES","Busstop_Code__c":"24042","Busstop__c":"a0M7Z00000EZt1fUAD","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yP3UAJ","Is_Active__c":true,"Latitude__c":50.834400000000000,"Longitude__c":4.476650000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:30","Time__c":"13:30:00.000Z","Time_and_Busstopp_Name__c":"13:30 - AV DES TOURTERELLES / AV DES BICHES"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yV4UAJ"},"Bus_Stop_Name__c":"AV DES GRANDS PRIX / AV F. PEETERS","Busstop_Code__c":"50039","Busstop__c":"a0M7Z00000EZt05UAD","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yV4UAJ","Is_Active__c":true,"Latitude__c":50.835500000000000,"Longitude__c":4.465570000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:20","Time__c":"13:20:00.000Z","Time_and_Busstopp_Name__c":"13:20 - AV DES GRANDS PRIX / AV F. PEETERS"}]';
        return (List<RoutePlan__c>) JSON.deserialize(jsonString, List<RoutePlan__c>.class);
    }

    private static List<Busstop__c> getStops()
    {
        String jsonString = '[{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZt0cUAD"},"Id":"a0M7Z00000EZt0cUAD"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZt0bUAD"},"Id":"a0M7Z00000EZt0bUAD"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZt0jUAD"},"Id":"a0M7Z00000EZt0jUAD"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZt05UAD"},"Id":"a0M7Z00000EZt05UAD"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZt1fUAD"},"Id":"a0M7Z00000EZt1fUAD"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZt0NUAT"},"Id":"a0M7Z00000EZt0NUAT"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZszYUAT"},"Id":"a0M7Z00000EZszYUAT"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZsxBUAT"},"Id":"a0M7Z00000EZsxBUAT"}]';
        return (List<Busstop__c>) JSON.deserialize(jsonString, List<Busstop__c>.class);
    }
}


/*

plansForRoute : [{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yKJUAZ"},"Bus_Stop_Name__c":"Woluwe school","Busstop__c":"a0M7Z00000EZsxBUAT","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yKJUAZ","Is_Active__c":true,"Latitude__c":50.857281909330716,"Longitude__c":4.444917404272483,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:00","Time__c":"13:00:00.000Z","Time_and_Busstopp_Name__c":"13:0 - Woluwe school"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yNlUAJ"},"Bus_Stop_Name__c":"DE LIJN 315 PRINSENDAL / AV REINE ASTRID / vers Tervuren","Busstop_Code__c":"24010","Busstop__c":"a0M7Z00000EZszYUAT","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yNlUAJ","Is_Active__c":true,"Latitude__c":50.836900000000000,"Longitude__c":4.469550000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:18","Time__c":"13:18:00.000Z","Time_and_Busstopp_Name__c":"13:18 - DE LIJN 315 PRINSENDAL / AV REINE ASTRID / vers Tervuren"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yNvUAJ"},"Bus_Stop_Name__c":"DE LIJN 315 POTAARDE / AV REINE ASTRID / vers Tervuren","Busstop_Code__c":"24014","Busstop__c":"a0M7Z00000EZt0NUAT","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yNvUAJ","Is_Active__c":true,"Latitude__c":50.841100000000000,"Longitude__c":4.468680000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:16","Time__c":"13:16:00.000Z","Time_and_Busstopp_Name__c":"13:16 - DE LIJN 315 POTAARDE / AV REINE ASTRID / vers Tervuren"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yOXUAZ"},"Bus_Stop_Name__c":"AV BARON D'HUART / AV DES FRENES","Busstop_Code__c":"24028","Busstop__c":"a0M7Z00000EZt0bUAD","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yOXUAZ","Is_Active__c":true,"Latitude__c":50.833700000000000,"Longitude__c":4.468940000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:22","Time__c":"13:22:00.000Z","Time_and_Busstopp_Name__c":"13:22 - AV BARON D'HUART / AV DES FRENES"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yObUAJ"},"Bus_Stop_Name__c":"AV BARON D'HUART / AV DES FAISANS","Busstop_Code__c":"24029","Busstop__c":"a0M7Z00000EZt0cUAD","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yObUAJ","Is_Active__c":true,"Latitude__c":50.828600000000000,"Longitude__c":4.473280000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:26","Time__c":"13:26:00.000Z","Time_and_Busstopp_Name__c":"13:26 - AV BARON D'HUART / AV DES FAISANS"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yOkUAJ"},"Bus_Stop_Name__c":"AV BARON D'HUART / HEIDEKRUIDLAAN","Busstop_Code__c":"24036","Busstop__c":"a0M7Z00000EZt0jUAD","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yOkUAJ","Is_Active__c":true,"Latitude__c":50.831200000000000,"Longitude__c":4.472550000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:24","Time__c":"13:24:00.000Z","Time_and_Busstopp_Name__c":"13:24 - AV BARON D'HUART / HEIDEKRUIDLAAN"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yP3UAJ"},"Bus_Stop_Name__c":"AV DES TOURTERELLES / AV DES BICHES","Busstop_Code__c":"24042","Busstop__c":"a0M7Z00000EZt1fUAD","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yP3UAJ","Is_Active__c":true,"Latitude__c":50.834400000000000,"Longitude__c":4.476650000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:30","Time__c":"13:30:00.000Z","Time_and_Busstopp_Name__c":"13:30 - AV DES TOURTERELLES / AV DES BICHES"},{"attributes":{"type":"RoutePlan__c","url":"/services/data/v56.0/sobjects/RoutePlan__c/a0O7Z00000O4yV4UAJ"},"Bus_Stop_Name__c":"AV DES GRANDS PRIX / AV F. PEETERS","Busstop_Code__c":"50039","Busstop__c":"a0M7Z00000EZt05UAD","Departure_Time__c":"13:00","Id":"a0O7Z00000O4yV4UAJ","Is_Active__c":true,"Latitude__c":50.835500000000000,"Longitude__c":4.465570000000000,"Remaining_Capacity__c":54.00,"Route__c":"a0N7Z00000Cq8UCUAZ","TimeTxT__c":"13:20","Time__c":"13:20:00.000Z","Time_and_Busstopp_Name__c":"13:20 - AV DES GRANDS PRIX / AV F. PEETERS"}]
busstopsWithRides : [{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZt0cUAD"},"Id":"a0M7Z00000EZt0cUAD"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZt0bUAD"},"Id":"a0M7Z00000EZt0bUAD"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZt0jUAD"},"Id":"a0M7Z00000EZt0jUAD"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZt05UAD"},"Id":"a0M7Z00000EZt05UAD"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZt1fUAD"},"Id":"a0M7Z00000EZt1fUAD"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZt0NUAT"},"Id":"a0M7Z00000EZt0NUAT"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZszYUAT"},"Id":"a0M7Z00000EZszYUAT"},{"attributes":{"type":"Busstop__c","url":"/services/data/v56.0/sobjects/Busstop__c/a0M7Z00000EZsxBUAT"},"Id":"a0M7Z00000EZsxBUAT"}]

*/